
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Core-loss</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/tutorials/core_loss';</script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Customizing abTEM" href="custom_simulation_objects.html" />
    <link rel="prev" title="PRISM" href="prism.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt=" - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt=" - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Welcome!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Get started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/basics.html">Basic examples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../walkthrough/walkthrough.html">Walkthrough</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../walkthrough/atomic_models.html">Atomic models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../walkthrough/potentials.html">Potentials</a></li>

<li class="toctree-l2"><a class="reference internal" href="../walkthrough/wave_functions.html">Wave functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../walkthrough/multislice.html">Multislice simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../walkthrough/contrast_transfer_function.html">Contrast transfer function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../walkthrough/scan_and_detect.html">Scan and detect</a></li>
<li class="toctree-l2"><a class="reference internal" href="../walkthrough/frozen_phonons.html">Frozen phonons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../walkthrough/parallelization.html">Parallelization</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../appendix/appendix.html">Appendix</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../appendix/conventions.html">Conventions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/multislice_derivation.html">Deriving the Multislice Algorithm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/antialiasing.html">Sampling and antialiasing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/ensembles.html">Ensembles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../appendix/convergence.html">Convergence</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="tutorials.html">Advanced tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="advanced_atomic_models.html">Advanced atomic models</a></li>
<li class="toctree-l2"><a class="reference internal" href="partial_coherence.html">Partial coherence</a></li>
<li class="toctree-l2"><a class="reference internal" href="charge_density.html"><em>ab initio</em> potentials with GPAW</a></li>
<li class="toctree-l2"><a class="reference internal" href="blochwave.html">Blochwave simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="prism.html">PRISM</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Core-loss</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_simulation_objects.html">Customizing <em>ab</em>TEM</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/examples.html">Example gallery</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/cbed_quickstart.html">CBED quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/hrtem_quickstart.html">HRTEM quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/prism_quickstart.html">PRISM quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/stem_quickstart.html">STEM quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/4d-stem_quickstart.html">4D-STEM quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/saed_quickstart.html">SAED quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/ped_quickstart.html">PED quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/animations.html">Animations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/interactions.html">Interactive visualizations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">Bibliography</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/api/api.html">API</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.antialias.html">antialias</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.antialias.antialias_aperture.html">antialias_aperture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.antialias.AntialiasAperture.html">AntialiasAperture</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.array.html">array</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.array.concatenate.html">concatenate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.array.from_zarr.html">from_zarr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.array.move_item.html">move_item</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.array.moveaxis.html">moveaxis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.array.stack.html">stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.array.swapaxes.html">swapaxes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.array.ArrayObject.html">ArrayObject</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.array.ComputableList.html">ComputableList</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.html">atoms</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.atoms_in_cell.html">atoms_in_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.best_orthogonal_cell.html">best_orthogonal_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.cut_cell.html">cut_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.decompose_affine_transform.html">decompose_affine_transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.euler_sequence.html">euler_sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.euler_to_rotation.html">euler_to_rotation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.flip_atoms.html">flip_atoms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.is_cell_hexagonal.html">is_cell_hexagonal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.is_cell_orthogonal.html">is_cell_orthogonal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.is_cell_valid.html">is_cell_valid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.merge_close_atoms.html">merge_close_atoms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.orthogonalize_cell.html">orthogonalize_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.pad_atoms.html">pad_atoms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.plane_to_axes.html">plane_to_axes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.pretty_print_transform.html">pretty_print_transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.rotate_atoms.html">rotate_atoms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.rotate_atoms_to_plane.html">rotate_atoms_to_plane</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.rotation_matrix_from_plane.html">rotation_matrix_from_plane</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.rotation_matrix_to_euler.html">rotation_matrix_to_euler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.shrink_cell.html">shrink_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.standardize_cell.html">standardize_cell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.atoms.wrap_with_tolerance.html">wrap_with_tolerance</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.waves.html">waves</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.waves.BaseWaves.html">BaseWaves</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.waves.PlaneWave.html">PlaneWave</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.waves.Probe.html">Probe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.waves.Waves.html">Waves</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.scan.html">scan</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.scan.BaseScan.html">BaseScan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.scan.CustomScan.html">CustomScan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.scan.GridScan.html">GridScan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.scan.LineScan.html">LineScan</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.detectors.html">detectors</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.detectors.AnnularDetector.html">AnnularDetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.detectors.BaseDetector.html">BaseDetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.detectors.FlexibleAnnularDetector.html">FlexibleAnnularDetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.detectors.PixelatedDetector.html">PixelatedDetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.detectors.SegmentedDetector.html">SegmentedDetector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.detectors.WavesDetector.html">WavesDetector</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.measurements.html">measurements</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.measurements.calculate_max_reciprocal_space_vector.html">calculate_max_reciprocal_space_vector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.measurements.reciprocal_lattice_vector_mask.html">reciprocal_lattice_vector_mask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.measurements.BaseMeasurements.html">BaseMeasurements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.measurements.DiffractionPatterns.html">DiffractionPatterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.measurements.Images.html">Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.measurements.IndexedDiffractionPatterns.html">IndexedDiffractionPatterns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.measurements.MeasurementsEnsemble.html">MeasurementsEnsemble</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.measurements.PolarMeasurements.html">PolarMeasurements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.measurements.RealSpaceLineProfiles.html">RealSpaceLineProfiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.measurements.ReciprocalSpaceLineProfiles.html">ReciprocalSpaceLineProfiles</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.html">transfer</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-13"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.cartesian2polar.html">cartesian2polar</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.hard_aperture.html">hard_aperture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.nyquist_sampling.html">nyquist_sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.point_resolution.html">point_resolution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.polar2cartesian.html">polar2cartesian</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.scherzer_defocus.html">scherzer_defocus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.soft_aperture.html">soft_aperture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.Aberrations.html">Aberrations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.Aperture.html">Aperture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.BaseAperture.html">BaseAperture</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.BaseTransferFunction.html">BaseTransferFunction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.Bullseye.html">Bullseye</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.CTF.html">CTF</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.SpatialEnvelope.html">SpatialEnvelope</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.TemporalEnvelope.html">TemporalEnvelope</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.Vortex.html">Vortex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transfer.Zernike.html">Zernike</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transform.html">transform</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-14"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transform.ArrayObjectTransform.html">ArrayObjectTransform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transform.CompositeArrayObjectTransform.html">CompositeArrayObjectTransform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transform.EmptyTransform.html">EmptyTransform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transform.EnsembleTransform.html">EnsembleTransform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transform.ReciprocalSpaceMultiplication.html">ReciprocalSpaceMultiplication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transform.TransformFromFunc.html">TransformFromFunc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.transform.WavesTransform.html">WavesTransform</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.html">parametrizations</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-15"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.validate_parameters.html">validate_parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.validate_parametrization.html">validate_parametrization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.validate_sigmas.html">validate_sigmas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.EwaldParametrization.html">EwaldParametrization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.KirklandParametrization.html">KirklandParametrization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.LobatoParametrization.html">LobatoParametrization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.Parametrization.html">Parametrization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.PengParametrization.html">PengParametrization</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.functions.html">functions</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-16"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.functions.ewald.html">ewald</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.functions.kirkland.html">kirkland</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.functions.lobato.html">lobato</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.parametrizations.functions.peng.html">peng</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.html">integrals</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-17"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.cutoff.html">cutoff</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.cutoff_taper.html">cutoff_taper</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.interpolate_radial_functions.html">interpolate_radial_functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.sinc.html">sinc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.superpose_deltas.html">superpose_deltas</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.FieldIntegrator.html">FieldIntegrator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.GaussianProjectionIntegrals.html">GaussianProjectionIntegrals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.GaussianScatteringFactors.html">GaussianScatteringFactors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.ProjectionIntegralTable.html">ProjectionIntegralTable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.QuadratureProjectionIntegrals.html">QuadratureProjectionIntegrals</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.integrals.ScatteringFactorProjectionIntegrals.html">ScatteringFactorProjectionIntegrals</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.inelastic.phonons.html">phonons</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-18"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.inelastic.phonons.AtomsEnsemble.html">AtomsEnsemble</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.inelastic.phonons.BaseFrozenPhonons.html">BaseFrozenPhonons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.inelastic.phonons.DummyFrozenPhonons.html">DummyFrozenPhonons</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.inelastic.phonons.FrozenPhonons.html">FrozenPhonons</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.distributions.html">distributions</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-19"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.distributions.from_values.html">from_values</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.distributions.gaussian.html">gaussian</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.distributions.uniform.html">uniform</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.distributions.validate_distribution.html">validate_distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.distributions.BaseDistribution.html">BaseDistribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.distributions.DistributionFromValues.html">DistributionFromValues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.distributions.EnsembleFromDistributions.html">EnsembleFromDistributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.distributions.MultidimensionalDistribution.html">MultidimensionalDistribution</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.html">potentials</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-20"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.charge_density.html">charge_density</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-21"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.charge_density.add_point_charges_fourier.html">add_point_charges_fourier</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.charge_density.integrate_gradient_fourier.html">integrate_gradient_fourier</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.charge_density.ChargeDensityPotential.html">ChargeDensityPotential</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.gpaw.html">gpaw</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-22"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.gpaw.get_core_correction_interpolators.html">get_core_correction_interpolators</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.gpaw.integrate_slice.html">integrate_slice</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.gpaw.GPAWParametrization.html">GPAWParametrization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.gpaw.GPAWPotential.html">GPAWPotential</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.iam.html">iam</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-23"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.iam.BaseField.html">BaseField</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.iam.BasePotential.html">BasePotential</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.iam.CrystalPotential.html">CrystalPotential</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.iam.FieldArray.html">FieldArray</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.iam.Potential.html">Potential</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.iam.PotentialArray.html">PotentialArray</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.potentials.iam.TransmissionFunction.html">TransmissionFunction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.tilt.html">tilt</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-24"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.tilt.precession_tilts.html">precession_tilts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.tilt.AxisAlignedBeamTilt.html">AxisAlignedBeamTilt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.tilt.BaseBeamTilt.html">BaseBeamTilt</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.tilt.BeamTilt.html">BeamTilt</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.html">visualize</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-25"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.html">artists</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-26"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.default_cbar_scalar_formatter.html">default_cbar_scalar_formatter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.get_extent.html">get_extent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.validate_cmap.html">validate_cmap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.AreaIndicator.html">AreaIndicator</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.Artist.html">Artist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.Artist1D.html">Artist1D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.Artist2D.html">Artist2D</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.CircleAnnotations.html">CircleAnnotations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.DomainColoringArtist.html">DomainColoringArtist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.ImageArtist.html">ImageArtist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.LinesArtist.html">LinesArtist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.OverlayImshowArtist.html">OverlayImshowArtist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.ScaleBar.html">ScaleBar</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.ScaledCircleCollection.html">ScaledCircleCollection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.artists.ScatterArtist.html">ScatterArtist</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.axes_grid.html">axes_grid</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-27"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.axes_grid.AxesCollection.html">AxesCollection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.axes_grid.AxesGrid.html">AxesGrid</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.visualizations.html">visualizations</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-28"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.visualizations.convert_complex.html">convert_complex</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.visualizations.discrete_cmap.html">discrete_cmap</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.visualizations.show_atoms.html">show_atoms</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.visualizations.Visualization.html">Visualization</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.widgets.html">widgets</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-29"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.widgets.make_toggle_hkl_button.html">make_toggle_hkl_button</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.widgets.slider_from_axes_metadata.html">slider_from_axes_metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.widgets.BaseGUI.html">BaseGUI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.widgets.ImageGUI.html">ImageGUI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.widgets.LinesGUI.html">LinesGUI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.visualize.widgets.ScatterGUI.html">ScatterGUI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.multislice.html">multislice</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-30"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.multislice.allocate_multislice_measurements.html">allocate_multislice_measurements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.multislice.conventional_multislice_step.html">conventional_multislice_step</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.multislice.multislice_and_detect.html">multislice_and_detect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.multislice.transition_potential_multislice_and_detect.html">transition_potential_multislice_and_detect</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.multislice.FresnelPropagator.html">FresnelPropagator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/api/_autosummary/abtem.multislice.MultisliceTransform.html">MultisliceTransform</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.html">prism</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-31"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.s_matrix.html">s_matrix</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-32"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.s_matrix.BaseSMatrix.html">BaseSMatrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.s_matrix.SMatrix.html">SMatrix</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.s_matrix.SMatrixArray.html">SMatrixArray</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.utils.html">utils</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-33"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.utils.batch_crop_2d.html">batch_crop_2d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.utils.minimum_crop.html">minimum_crop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.utils.plane_waves.html">plane_waves</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.utils.prism_coefficients.html">prism_coefficients</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.utils.prism_wave_vectors.html">prism_wave_vectors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.utils.wrapped_crop_2d.html">wrapped_crop_2d</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../reference/api/_autosummary/abtem.prism.utils.wrapped_slices.html">wrapped_slices</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/config.html">Configuration</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">abTEM</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../abtem/contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../abtem/contribute.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../abtem/cite.html">Cite</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../abtem/changelog.html">Changelog</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fuser_guide/tutorials/core_loss.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/user_guide/tutorials/core_loss.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Core-loss</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#core-loss-transitions">Core-loss transitions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transition-potentials">Transition potentials</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#energy-differential-cross-sections">Energy differential cross-sections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#core-loss-filtered">Core-loss filtered</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#core-loss-in-atomic-resolution-imaging">Core-loss in atomic resolution imaging</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="dropdown admonition warning">
<p class="admonition-title">Warning</p>
<p>Requires optional libraries</p>
<p>This notebook requires a working installation of <a class="reference external" href="https://wiki.fysik.dtu.dk/gpaw/index.html">GPAW</a>.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
conda</label><div class="sd-tab-content docutils">
<p>Install GPAW using conda:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">gpaw</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-1">
pip</label><div class="sd-tab-content docutils">
<p>Install GPAW using pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">gpaw</span>
</pre></div>
</div>
<p>Install the PAW datasets into the folder <code class="docutils literal notranslate"><span class="pre">&lt;dir&gt;</span></code> using this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gpaw</span> <span class="n">install</span><span class="o">-</span><span class="n">data</span> <span class="o">&lt;</span><span class="nb">dir</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<p>See <a class="reference external" href="https://wiki.fysik.dtu.dk/gpaw/install.html">here</a> for detailed installation instructions.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ase</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">abtem.inelastic.core_loss</span> <span class="kn">import</span> <span class="n">SubshellTransitions</span>
<span class="kn">from</span> <span class="nn">ase</span> <span class="kn">import</span> <span class="n">units</span>
<span class="kn">from</span> <span class="nn">ase.io</span> <span class="kn">import</span> <span class="n">read</span>

<span class="kn">import</span> <span class="nn">abtem</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="core-loss">
<span id="tutorials-core-loss"></span><h1>Core-loss<a class="headerlink" href="#core-loss" title="Link to this heading">#</a></h1>
<p>This tutorial demonstrates how to calculate an energy-filtered STEM image using abTEM. We show how to calculate projected overlap integrals following to C. Dwyer (see <a class="reference external" href="https://doi.org/10.1016/j.ultramic.2005.03.005">https://doi.org/10.1016/j.ultramic.2005.03.005</a> and use them in a dynamical scattering simulation. We use the Density Functional Theory code <a class="reference external" href="https://wiki.fysik.dtu.dk/gpaw/index.html">GPAW</a> for calculating the wave functions for the overlap integrals. Please see our citation guide if you use this code in a publication.</p>
<p>We will first roughly reproduce the results of C. Dwyer, which the implementation is largely based on. In the second half of the tutorial, we present a the typical core-loss energy filtered simulation using abTEM.</p>
<div class="no-icon admonition">
<p class="admonition-title"><svg version="4.0.0.63c5cb3" width="1.5rem" height="1.5rem" class="sd-material-icon sd-material-icon-engineering sd-mr-1" viewBox="0 0 24 24" aria-hidden="true"><g><rect fill="none" height="24" width="24"></rect></g><g><g><path d="M9,15c-2.67,0-8,1.34-8,4v2h16v-2C17,16.34,11.67,15,9,15z"></path><path d="M22.1,6.84c0.01-0.11,0.02-0.22,0.02-0.34c0-0.12-0.01-0.23-0.03-0.34l0.74-0.58c0.07-0.05,0.08-0.15,0.04-0.22l-0.7-1.21 c-0.04-0.08-0.14-0.1-0.21-0.08L21.1,4.42c-0.18-0.14-0.38-0.25-0.59-0.34l-0.13-0.93C20.36,3.06,20.29,3,20.2,3h-1.4 c-0.09,0-0.16,0.06-0.17,0.15L18.5,4.08c-0.21,0.09-0.41,0.21-0.59,0.34l-0.87-0.35c-0.08-0.03-0.17,0-0.21,0.08l-0.7,1.21 c-0.04,0.08-0.03,0.17,0.04,0.22l0.74,0.58c-0.02,0.11-0.03,0.23-0.03,0.34c0,0.11,0.01,0.23,0.03,0.34l-0.74,0.58 c-0.07,0.05-0.08,0.15-0.04,0.22l0.7,1.21c0.04,0.08,0.14,0.1,0.21,0.08l0.87-0.35c0.18,0.14,0.38,0.25,0.59,0.34l0.13,0.93 C18.64,9.94,18.71,10,18.8,10h1.4c0.09,0,0.16-0.06,0.17-0.15l0.13-0.93c0.21-0.09,0.41-0.21,0.59-0.34l0.87,0.35 c0.08,0.03,0.17,0,0.21-0.08l0.7-1.21c0.04-0.08,0.03-0.17-0.04-0.22L22.1,6.84z M19.5,7.75c-0.69,0-1.25-0.56-1.25-1.25 s0.56-1.25,1.25-1.25s1.25,0.56,1.25,1.25S20.19,7.75,19.5,7.75z"></path><path d="M19.92,11.68l-0.5-0.87c-0.03-0.06-0.1-0.08-0.15-0.06l-0.62,0.25c-0.13-0.1-0.27-0.18-0.42-0.24l-0.09-0.66 C18.12,10.04,18.06,10,18,10h-1c-0.06,0-0.11,0.04-0.12,0.11l-0.09,0.66c-0.15,0.06-0.29,0.15-0.42,0.24l-0.62-0.25 c-0.06-0.02-0.12,0-0.15,0.06l-0.5,0.87c-0.03,0.06-0.02,0.12,0.03,0.16l0.53,0.41c-0.01,0.08-0.02,0.16-0.02,0.24 c0,0.08,0.01,0.17,0.02,0.24l-0.53,0.41c-0.05,0.04-0.06,0.11-0.03,0.16l0.5,0.87c0.03,0.06,0.1,0.08,0.15,0.06l0.62-0.25 c0.13,0.1,0.27,0.18,0.42,0.24l0.09,0.66C16.89,14.96,16.94,15,17,15h1c0.06,0,0.12-0.04,0.12-0.11l0.09-0.66 c0.15-0.06,0.29-0.15,0.42-0.24l0.62,0.25c0.06,0.02,0.12,0,0.15-0.06l0.5-0.87c0.03-0.06,0.02-0.12-0.03-0.16l-0.52-0.41 c0.01-0.08,0.02-0.16,0.02-0.24c0-0.08-0.01-0.17-0.02-0.24l0.53-0.41C19.93,11.81,19.94,11.74,19.92,11.68z M17.5,13.33 c-0.46,0-0.83-0.38-0.83-0.83c0-0.46,0.38-0.83,0.83-0.83s0.83,0.38,0.83,0.83C18.33,12.96,17.96,13.33,17.5,13.33z"></path><path d="M4.74,9h8.53c0.27,0,0.49-0.22,0.49-0.49V8.49c0-0.27-0.22-0.49-0.49-0.49H13c0-1.48-0.81-2.75-2-3.45V5.5 C11,5.78,10.78,6,10.5,6S10,5.78,10,5.5V4.14C9.68,4.06,9.35,4,9,4S8.32,4.06,8,4.14V5.5C8,5.78,7.78,6,7.5,6S7,5.78,7,5.5V4.55 C5.81,5.25,5,6.52,5,8H4.74C4.47,8,4.25,8.22,4.25,8.49v0.03C4.25,8.78,4.47,9,4.74,9z"></path><path d="M9,13c1.86,0,3.41-1.28,3.86-3H5.14C5.59,11.72,7.14,13,9,13z"></path></g></g></svg> Currently Under Construction</p>
<p>Check back for more</p>
</div>
<section id="core-loss-transitions">
<h2>Core-loss transitions<a class="headerlink" href="#core-loss-transitions" title="Link to this heading">#</a></h2>
<p>The first step is to select the transitions. Here we target the <em>K</em>-edge of Silicon i.e. the 1<em>s</em> subshell; quantum numbers <span class="math notranslate nohighlight">\((n, \ell) = (1, 0)\)</span>. In a hypothetical experiment, this would be roughly equivalent to only collecting electrons with an energy loss of <span class="math notranslate nohighlight">\(10 \ \mathrm{eV}\)</span> above the ionization threshold of <span class="math notranslate nohighlight">\(1840 \ \mathrm{eV}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># atomic number</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># principal quantum number</span>
<span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># azimuthal quantum number</span>
<span class="n">xc</span> <span class="o">=</span> <span class="s2">&quot;PBE&quot;</span>  <span class="c1"># exchange-correlation functional</span>

<span class="n">Si_transitions</span> <span class="o">=</span> <span class="n">SubshellTransitions</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="n">Z</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="s2">&quot;PBE&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bound electron configuration:&quot;</span><span class="p">,</span> <span class="n">Si_transitions</span><span class="o">.</span><span class="n">bound_configuration</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ionic electron configuration:&quot;</span><span class="p">,</span> <span class="n">Si_transitions</span><span class="o">.</span><span class="n">excited_configuration</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>bound electron configuration: 1s2 2s2 2p6 3s2 3p2
ionic electron configuration: 1s1 2s2 2p6 3s2 3p2
</pre></div>
</div>
</div>
</div>
<p>There is an infinite number of possible transitions from the bound state to the continuum, however, only transitions with small changes in orbital angular momentum quantum number, <span class="math notranslate nohighlight">\(\Delta \ell\)</span>, will to contribute meaningfully. Choosing a maximum transition order, <span class="math notranslate nohighlight">\(\Delta \ell_{max}\)</span>, we include only transitions with continuum orbital angular momentum quantum number:
$<span class="math notranslate nohighlight">\(
\ell' = \ell, \ell \pm 1, \ell \pm 2, \ldots , \ell \pm \Delta \ell_{max} \quad  \ell' \geq 0
\)</span>$
This is controlled by setting i.e. <code class="docutils literal notranslate"><span class="pre">order</span> <span class="pre">=</span> <span class="pre">0</span></code> gives just the monopole term, <code class="docutils literal notranslate"><span class="pre">order</span> <span class="pre">=</span> <span class="pre">1</span></code> gives also includes all dipole terms and <code class="docutils literal notranslate"><span class="pre">order</span> <span class="pre">=</span> <span class="pre">2</span></code> includes up to all quadropole terms etc.</p>
<p>Given an orbital angular momentum quantum number <span class="math notranslate nohighlight">\(\ell\)</span> (or <span class="math notranslate nohighlight">\(\ell'\)</span>) the possible magnetic quantum numbers are:</p>
<div class="math notranslate nohighlight">
\[
m_{\ell} = -\ell, \ell + 1, \ldots, \ell \quad .
\]</div>
<p>Below we print the quantum numbers for the bound and continuum states up quadropole transitions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">bound_state</span><span class="p">,</span> <span class="n">continuum_state</span> <span class="ow">in</span> <span class="n">Si_transitions</span><span class="o">.</span><span class="n">get_transition_quantum_numbers</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(n, l, ml)  (l&#39;, ml&#39;) = </span><span class="si">{</span><span class="n">bound_state</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">continuum_state</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (0, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (1, -1)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (1, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (1, 1)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (2, -2)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (2, -1)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (2, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (2, 1)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (2, 2)
</pre></div>
</div>
</div>
</div>
<p>The wave functions for the bound and continuum states, the atomic wave functions can be written as products of radial and angular parts, i.e
$<span class="math notranslate nohighlight">\(
\phi_{nm\ell} = \frac{P_{n\ell}(r)}{r} Y_{\ell}^{m}(\hat{\mathbf{r}}) \quad \mathrm{and} \quad \phi_{nm\ell} = \frac{P_{\epsilon_f\ell'}(r)}{r} Y_{\ell'}^{m'}(\hat{\mathbf{r}}) \quad ,
\)</span>$</p>
<p>where <span class="math notranslate nohighlight">\(Y_{\ell}^{m}\)</span> represent spherical harmonics. In <em>ab</em>TEM the radial wave functions, <span class="math notranslate nohighlight">\(P_{n\ell}\)</span> and <span class="math notranslate nohighlight">\(P_{\epsilon_f\ell}\)</span>, are calculated using a all-electron DFT  with using the scalar-relatistically corrected Schrdinger equation. We can get the bound radial wave function, <span class="math notranslate nohighlight">\(P_{10}\)</span>, using <code class="docutils literal notranslate"><span class="pre">get_bound_wave_function</span></code> and the continuum wave function, <span class="math notranslate nohighlight">\(P_{\epsilon_f 0}\)</span>, <span class="math notranslate nohighlight">\(P_{\epsilon_f 1}\)</span> and <span class="math notranslate nohighlight">\(P_{\epsilon_f 2}\)</span>, using <code class="docutils literal notranslate"><span class="pre">get_excited_wave_functions</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bound_state</span> <span class="o">=</span> <span class="n">Si_transitions</span><span class="o">.</span><span class="n">get_bound_wave_function</span><span class="p">()</span>
<span class="n">excited_states</span> <span class="o">=</span> <span class="n">Si_transitions</span><span class="o">.</span><span class="n">get_excited_wave_functions</span><span class="p">()</span>

<span class="n">bound_state</span><span class="p">,</span> <span class="n">excited_states</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;abtem.inelastic.core_loss.RadialWavefunction at 0x7f4574f99650&gt;,
 [&lt;abtem.inelastic.core_loss.RadialWavefunction at 0x7f4575163390&gt;,
  &lt;abtem.inelastic.core_loss.RadialWavefunction at 0x7f4476c93990&gt;,
  &lt;abtem.inelastic.core_loss.RadialWavefunction at 0x7f4476ab5810&gt;])
</pre></div>
</div>
</div>
</div>
<p>Below we plot the the bound and radial wave functions, this is a reproduction of Fig. 1 in Dwyers paper. Note, that there are minor differences, as Dwyer uses a HermanSkillman wave functions instead of DFT.</p>
<p>The left and right y-axes correspond to <span class="math notranslate nohighlight">\(P_{10}\)</span> and <span class="math notranslate nohighlight">\(P_{\epsilon_f \ell '}\)</span>. The unit of length in the figure is the Bohr radius <span class="math notranslate nohighlight">\(a_0 = 0.529 \ \mathrm{}\)</span> and the unit of energy is the Rydberg energy <span class="math notranslate nohighlight">\(\mathrm{Ry} = 13.6 \ \mathrm{eV}\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">lines</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">bound_state</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$P_</span><span class="si">{10}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

<span class="k">for</span> <span class="n">excited_state</span> <span class="ow">in</span> <span class="n">excited_states</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">+=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">excited_state</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;$P_</span><span class="se">{{</span><span class="s2">\epsilon_f </span><span class="si">{</span><span class="n">excited_state</span><span class="o">.</span><span class="n">l</span><span class="si">}</span><span class="se">}}</span><span class="s2">$&quot;</span>
    <span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">7</span><span class="p">])</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$P_</span><span class="si">{10}</span><span class="s2">(r) \ [a_0^{-1/2}]$&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$P_{{\epsilon_fl&#39;}}(r) \ [a_0^{-1/2} \mathrm</span><span class="si">{Ry}</span><span class="s2">^{-1/2}]$&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$r \ [a_0]$&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/0dc982602046dd80baed8cfea86d1873d9c641395a307342d6b32ed84ca1fb01.png" src="../../_images/0dc982602046dd80baed8cfea86d1873d9c641395a307342d6b32ed84ca1fb01.png" />
</div>
</div>
</section>
<section id="transition-potentials">
<h2>Transition potentials<a class="headerlink" href="#transition-potentials" title="Link to this heading">#</a></h2>
<p>We want to calculate the lateral part of the wave function of the inelastically scattered electrons, <span class="math notranslate nohighlight">\(\psi_{f}(\mathbf{r}_{\perp}, z)\)</span>, just after undergoing scattering at a depth <span class="math notranslate nohighlight">\(z\)</span>. We first calculate the elastic wave function <span class="math notranslate nohighlight">\(\psi_{i}(\mathbf{r}_{\perp}, z)\)</span> at by propagating the wave function using multislice, then the inelastically scattered wave function may be given as a product with a projected transition potential
$<span class="math notranslate nohighlight">\(
    \psi_{f}(\mathbf{r}_{\perp}, z) = V_{fi}(\mathbf{r}_{\perp}) \psi_{i}(\mathbf{r}_{\perp}, z) \quad .
\)</span>$</p>
<p>The inelastic transition potential is given by
$<span class="math notranslate nohighlight">\(
V_{fi}(\mathbf{r}_{\perp}) = \int_{-\Delta z / 2}^{\Delta z / 2} \langle \phi_f | V_e | \phi_i \rangle e^{2 \pi i (k_i  k_f) z} \mathrm{d}z
\)</span><span class="math notranslate nohighlight">\(
with
\)</span><span class="math notranslate nohighlight">\(
\langle \phi_f | V_e | \phi_i \rangle = \int \phi^*_f(\mathbf{r}) \frac{e^2}{4\pi\epsilon_0 |\mathbf{r} - \mathbf{r}'|} \phi_i(\mathbf{r}') \mathrm{d}\mathbf{r}' \quad ,
\)</span><span class="math notranslate nohighlight">\(
where the operator, \)</span>V_e<span class="math notranslate nohighlight">\(, is the Coulomb potential mediating the interaction, \)</span>\phi_i<span class="math notranslate nohighlight">\( is the bound state of the transition and \)</span>\phi_f$ is one of the included continuum states.</p>
<p>We will from now on only include 1st order transitions, hence, we again create the <code class="docutils literal notranslate"><span class="pre">SubshellTransitions</span></code> for the Silicon <em>K</em>-edge setting <code class="docutils literal notranslate"><span class="pre">order=1</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Si_transitions</span> <span class="o">=</span> <span class="n">SubshellTransitions</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="n">Z</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">l</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="s2">&quot;PBE&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="k">for</span> <span class="n">bound_state</span><span class="p">,</span> <span class="n">continuum_state</span> <span class="ow">in</span> <span class="n">Si_transitions</span><span class="o">.</span><span class="n">get_transition_quantum_numbers</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(n, l, ml)  (l&#39;, ml&#39;) = </span><span class="si">{</span><span class="n">bound_state</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">continuum_state</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (0, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (1, -1)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (1, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (1, 1)
</pre></div>
</div>
</div>
</div>
<p>We create the transition potentials for an incoming wave function with an energy of <span class="math notranslate nohighlight">\(100 \ \mathrm{keV}\)</span>, defined on a grid with <span class="math notranslate nohighlight">\(200 \times 200\)</span> grid points and an extent of <span class="math notranslate nohighlight">\(2 \ \mathrm{}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transition_potential</span> <span class="o">=</span> <span class="n">Si_transitions</span><span class="o">.</span><span class="n">get_transition_potentials</span><span class="p">(</span>
    <span class="n">gpts</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="mf">100e3</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can show the complex transition potentials using domain coloring. This figure is equivalent in content to Fig. 2 in the Dwyer paper.</p>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualization</span> <span class="o">=</span> <span class="n">transition_potential</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
    <span class="n">explode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">common_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="mf">0.42</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/66cb26dc203fd9f6d5ff8f3794402aa80e1183c4fe7bee79fbe8448a80204011.png" src="../../_images/66cb26dc203fd9f6d5ff8f3794402aa80e1183c4fe7bee79fbe8448a80204011.png" />
</div>
</div>
</section>
<section id="energy-differential-cross-sections">
<h2>Energy differential cross-sections<a class="headerlink" href="#energy-differential-cross-sections" title="Link to this heading">#</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following is not equivalent to a typical <em>ab</em>TEM simulation using a transition potential, see next section.</p>
</div>
<p>Next, we shall calculate the probabilty per unit energy (or energy differential cross-section) for core-loss scattering at a depth <span class="math notranslate nohighlight">\(z\)</span> from a specific atom up to a given scattering angle <span class="math notranslate nohighlight">\(k_{cut}\)</span></p>
<div class="math notranslate nohighlight" id="equation-eq-scattering-probability">
<span class="eqno">(10)<a class="headerlink" href="#equation-eq-scattering-probability" title="Link to this equation">#</a></span>\[
\frac{\mathrm{d}\sigma}{\mathrm{d}E}\left(z\right) = \sigma^2  \int_{0}^{k_{cut}} A(k) \sum_{f} |\psi_f(\mathbf{k}_{\perp}, z)|^2 \ \mathrm{d}\mathbf{k} \quad ,
\]</div>
<p>where <span class="math notranslate nohighlight">\(\sigma\)</span> on the rhs is the interaction constant, <span class="math notranslate nohighlight">\(V_{fi}\)</span> is the transition potential for a specified transiton of an atom in a specified position, <span class="math notranslate nohighlight">\(\psi(\mathbf{k}, z)\)</span> is the reciprocal space wave function at a depth <span class="math notranslate nohighlight">\(z\)</span> and <span class="math notranslate nohighlight">\(A(k)\)</span> is the aperture function describing the maximum collection angle of the energy filter</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    A(k) = \begin{cases} 1 &amp; \text{if } k \leq k_{cut} \\ 0 &amp; \text{if } k &gt; k_{cut} \end{cases} .
\end{split}\]</div>
<p>This equation neglects all elastic scattering after the inelastic scattering event, sometimes called single-channeling. We describe the more accurate double-channeling, in the next section.</p>
<p>The above equation is essentially equivalent Eq. 16 in the Dwyer paper, the main difference being that we integrate in reciprocal space. We shall roughly reproduce the bold full line shown in Fig. 4 of that paper, this is the result obtained by placing the beam on an atomic column and calculating the equation above for inealstic scattering from only atoms in that column.</p>
<p>We create an atomic structure of silicon in the <span class="math notranslate nohighlight">\(\left&lt;100\right&gt;\)</span> zone axis with a thickness <span class="math notranslate nohighlight">\(500 \ \mathrm{}\)</span> and a converged lateral extent. Then we create a potential with exit planes every ten slices.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">atoms</span> <span class="o">=</span> <span class="n">ase</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">bulk</span><span class="p">(</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span> <span class="n">cubic</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">92</span><span class="p">)</span>
<span class="n">atoms</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">potential</span> <span class="o">=</span> <span class="n">abtem</span><span class="o">.</span><span class="n">Potential</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">gpts</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">exit_planes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">slice_thickness</span><span class="o">=</span><span class="mf">5.43</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to keep the calculation time lower</p>
</div>
<p>We create the initial probe placed on the atomic column at <span class="math notranslate nohighlight">\((0,0)\)</span> with the same parameters as Dwyer and calculate the exit_waves for different thicknesses (i.e. <span class="math notranslate nohighlight">\(\psi_i(\mathbf{r}_{\perp}, z)\)</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">probe</span> <span class="o">=</span> <span class="n">abtem</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span>
    <span class="n">semiangle_cutoff</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="mf">100e3</span><span class="p">,</span> <span class="n">Cs</span><span class="o">=-</span><span class="mf">0.053e-3</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">,</span> <span class="n">defocus</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">C5</span><span class="o">=</span><span class="mf">50e-3</span> <span class="o">*</span> <span class="mf">1e10</span>
<span class="p">)</span>

<span class="n">wave</span> <span class="o">=</span> <span class="n">probe</span><span class="o">.</span><span class="n">multislice</span><span class="p">(</span><span class="n">potential</span><span class="p">,</span> <span class="n">scan</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="n">exit_waves</span> <span class="o">=</span> <span class="n">wave</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[########################################] | 100% Completed | 960.79 ms
</pre></div>
</div>
</div>
</div>
<p>We can use the transition potentials to calculate the scattered waves, <span class="math notranslate nohighlight">\(\psi_f(\mathbf{k}_{\perp}, z)\)</span>, for scattering from an atoms placed at <span class="math notranslate nohighlight">\((0,0)\)</span> by setting <code class="docutils literal notranslate"><span class="pre">sites=(0,0)</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transition_potentials</span> <span class="o">=</span> <span class="n">Si_transitions</span><span class="o">.</span><span class="n">get_transition_potentials</span><span class="p">()</span>

<span class="n">scattered</span> <span class="o">=</span> <span class="n">transition_potentials</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">exit_waves</span><span class="p">,</span> <span class="n">sites</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The scattered wave functions are returned as a 4D array, where the first axis represents the transitions, the second axis represents the exit planes and the last two dimensions represents the <span class="math notranslate nohighlight">\(xy\)</span>-plane.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scattered</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(4, 93, 256, 256)
</pre></div>
</div>
</div>
</div>
<p>Next, we calculate the incoherent sum over the transitions in reciprocal space, <span class="math notranslate nohighlight">\(\sum_{f} |\psi_f(\mathbf{k}_{\perp}, z)|^2\)</span>, by first getting the diffraction_patterns and then summing the first axis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diffraction_patterns</span> <span class="o">=</span> <span class="n">scattered</span><span class="o">.</span><span class="n">diffraction_patterns</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">0</span><span class="p">,))</span>
</pre></div>
</div>
</div>
</div>
<p>We show every twentieth diffraction pattern below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diffraction_patterns</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(93, 171, 171)
</pre></div>
</div>
</div>
</div>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualization</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">diffraction_patterns</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">20</span><span class="p">]</span>
    <span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>
    <span class="o">.</span><span class="n">show</span><span class="p">(</span>
        <span class="n">explode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;mrad&quot;</span><span class="p">,</span> <span class="n">common_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">visualization</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/52e22fdcb0b9b671ba57ea15281fda8f84d23fd096feaf27f4061b44692cd8b9.png" src="../../_images/52e22fdcb0b9b671ba57ea15281fda8f84d23fd096feaf27f4061b44692cd8b9.png" />
</div>
</div>
<p>To reproduce Fig. 4, we perform integrals with three different integration ranges from <span class="math notranslate nohighlight">\(0\)</span> to <span class="math notranslate nohighlight">\(5\)</span>, <span class="math notranslate nohighlight">\(20\)</span> and <span class="math notranslate nohighlight">\(50 \ \mathrm{mrad}\)</span>. The minor visible differences between Dwyers results and ours could be due to the slightly different atomic wave functions or because we neglected phonons to keep the demonstration simple.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">outer</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">measurements</span> <span class="o">=</span> <span class="n">diffraction_patterns</span><span class="o">.</span><span class="n">integrate_radial</span><span class="p">(</span><span class="n">inner</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="n">outer</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can use xarray show the data.</p>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da</span> <span class="o">=</span> <span class="n">measurements</span><span class="o">.</span><span class="n">to_data_array</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
    <span class="n">da</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c2afee4e7b7e459ca7143fbe075b5a72212ef6eed10b89302878651153c7b3b2.png" src="../../_images/c2afee4e7b7e459ca7143fbe075b5a72212ef6eed10b89302878651153c7b3b2.png" />
</div>
</div>
</section>
<section id="core-loss-filtered">
<h2>Core-loss filtered<a class="headerlink" href="#core-loss-filtered" title="Link to this heading">#</a></h2>
<p>We will now run a simulation using the standard interface of <em>ab</em>TEM. The main difference compared to above is that the contribution from all inelastic scattering events are collected into one single. When multiple exit planes are specified for the potential all events above each exit plane collects all previous scattering events.</p>
<p>We also neglected scattering after the inelastric event (single-channeling), by default this is <em>not</em> the case in <em>ab</em>TEM, but you can use it by setting <code class="docutils literal notranslate"><span class="pre">double_channel=False</span></code>. Double-channeling is always more accurate, but it is drastically slower, and as we shall see may not be necessary in some case for modern EELS detectors with large collection angles.</p>
<p>Single channeling requires the same number of multislice step as standard multislice; however, it is still necessary to calculate the scattering probabilities in Eq. <a class="reference internal" href="#equation-eq-scattering-probability">(10)</a> which may be expensive.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>The PRISM-based algorithm for core-loss filtered simulation created by Brown et al. provides up to identical accuracy to double-channeling, but scales scales linearly, i.e. similarly to single-channeling. We introduce our implementation of in this tutorial.</p>
</div>
<p>To compare single channeling to double channeling, we create a transition potentials in both modes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transition_potentials</span> <span class="o">=</span> <span class="n">Si_transitions</span><span class="o">.</span><span class="n">get_transition_potentials</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>In the simulation above, we only included inelastic scattering from the column at the position of the probe. By default all atoms in the potential matching the element given when creating the <code class="docutils literal notranslate"><span class="pre">SubshellTransitions</span></code> are used as sites of inelastic scattering events. However, it may still be useful to select only a subset of the atoms as sites. This could be used to understand the contribution from a region in the specimen or to drastically speed up a simulation.</p>
<p>Here we select the atoms in the atomic column at the probe position.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sites</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">]</span>

<span class="n">abtem</span><span class="o">.</span><span class="n">show_atoms</span><span class="p">(</span><span class="n">sites</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Figure size 640x480 with 1 Axes&gt;, &lt;Axes: xlabel=&#39;x []&#39;, ylabel=&#39;y []&#39;&gt;)
</pre></div>
</div>
<img alt="../../_images/3b9725c39b51e35cb85d9793bf80ea15648a16014f3db41abceb80979280dd44.png" src="../../_images/3b9725c39b51e35cb85d9793bf80ea15648a16014f3db41abceb80979280dd44.png" />
</div>
</div>
<p>We create a <code class="docutils literal notranslate"><span class="pre">PixelatedDetector</span></code> which will allow us to pick the maximum collection angle after the simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">detector</span> <span class="o">=</span> <span class="n">abtem</span><span class="o">.</span><span class="n">PixelatedDetector</span><span class="p">(</span><span class="n">max_angle</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can run an energy-filtered multislice simulation using the <code class="docutils literal notranslate"><span class="pre">transition_potential_multislice</span></code> method. We start by running the simulation using single-channeling.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">measurements_single</span> <span class="o">=</span> <span class="n">probe</span><span class="o">.</span><span class="n">transition_potential_scan</span><span class="p">(</span>
    <span class="n">scan</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">potential</span><span class="o">=</span><span class="n">potential</span><span class="p">,</span>
    <span class="n">detectors</span><span class="o">=</span><span class="n">detector</span><span class="p">,</span>
    <span class="n">transition_potentials</span><span class="o">=</span><span class="n">transition_potentials</span><span class="p">,</span>
    <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span>
    <span class="n">double_channel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">measurements_single</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[########################################] | 100% Completed | 1.66 sms
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;abtem.measurements.DiffractionPatterns at 0x7f443051ed50&gt;
</pre></div>
</div>
</div>
</div>
<p>We can estimate the number of multislice steps required when using double channeling. For a potential with roughly <span class="math notranslate nohighlight">\(N_a\)</span> atoms per slice with the excitation of interest, <span class="math notranslate nohighlight">\(N_t\)</span> transitions per excitation and <span class="math notranslate nohighlight">\(N_z\)</span> slices, we need <span class="math notranslate nohighlight">\(N_a N_s N_z (N_z - 1) / 2\)</span> multislice steps, where the last term comes from excitations deeper in the sample having fewer steps after the excitation. The estimate is for a single probe position and without phonons, hence a simulation could easily take months for a moderately large specimen.</p>
<p>Given that there is one inelastic scattering site per slice, the double channeling approach requires roughly the number of steps given below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">potential</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">potential</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Si_transitions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16744
</pre></div>
</div>
</div>
</div>
<p>The double channeling simulation below should take roughly a minute on a typical laptop.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">measurements_double</span> <span class="o">=</span> <span class="n">probe</span><span class="o">.</span><span class="n">transition_potential_scan</span><span class="p">(</span>
    <span class="n">scan</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">potential</span><span class="o">=</span><span class="n">potential</span><span class="p">,</span>
    <span class="n">detectors</span><span class="o">=</span><span class="n">detector</span><span class="p">,</span>
    <span class="n">transition_potentials</span><span class="o">=</span><span class="n">transition_potentials</span><span class="p">,</span>
    <span class="n">sites</span><span class="o">=</span><span class="n">sites</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">measurements_double</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[########################################] | 100% Completed | 33.49 ss
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;abtem.measurements.DiffractionPatterns at 0x7f444082b450&gt;
</pre></div>
</div>
</div>
</div>
<p>We stack the measurements to display the together . We used indexing to discard the zeroth exit plane as this contains the incoming beam.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacked</span> <span class="o">=</span> <span class="n">abtem</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
    <span class="p">[</span><span class="n">measurements_single</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">measurements_double</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span>
    <span class="n">axis_metadata</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;single channel&quot;</span><span class="p">,</span> <span class="s2">&quot;double channel&quot;</span><span class="p">),</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">integrated</span> <span class="o">=</span> <span class="n">stacked</span><span class="o">.</span><span class="n">integrate_radial</span><span class="p">(</span><span class="n">inner</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">integrated</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
    <span class="n">overlay</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">explode</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">common_scale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We see as expected that the single-channeling intensity is monotonically increasing function, in fact the intensity is just the cumulative sum of the result we calculated above
$<span class="math notranslate nohighlight">\(
I(z_{exit}) = \int_0^{z_{exit}} \frac{\mathrm{d}\sigma}{\mathrm{d}E}\left(z\right) \mathrm{d}z \quad .
\)</span>$</p>
<p>We see as expected that the single-channeling approach is appropritate when the maximum collection angle is large, i.e. when most of the inelastically scattered electrons are collected. However, as shown below this does not imply that the spectroscopic diffraction patterns of the single-channeling approximation are accurate.</p>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualization</span> <span class="o">=</span> <span class="n">abtem</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">stacked</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[::</span><span class="mi">20</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
    <span class="n">explode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">units</span><span class="o">=</span><span class="s2">&quot;mrad&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">common_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">power</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d05c6948381309d6e58a61cae17c3654a40f37fdbb87a3ac168ea07e64edd9c9.png" src="../../_images/d05c6948381309d6e58a61cae17c3654a40f37fdbb87a3ac168ea07e64edd9c9.png" />
</div>
</div>
</section>
<section id="core-loss-in-atomic-resolution-imaging">
<h2>Core-loss in atomic resolution imaging<a class="headerlink" href="#core-loss-in-atomic-resolution-imaging" title="Link to this heading">#</a></h2>
<p>For the purpose of keeping the computational load of this tutorial realtively low, we will use the single-channelling approach, thus these simulations are only accurate for large maximum collection angles.</p>
<p>We will simulate a zone axis simulation of SrTiO<sub>3</sub>, we use slightly</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ase.io</span> <span class="kn">import</span> <span class="n">read</span>

<span class="n">atoms</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="s2">&quot;../walkthrough/data/srtio3_100.cif&quot;</span><span class="p">)</span>

<span class="n">slice_thickness</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">atoms</span> <span class="o">*=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>

<span class="n">potential</span> <span class="o">=</span> <span class="n">abtem</span><span class="o">.</span><span class="n">Potential</span><span class="p">(</span>
    <span class="n">atoms</span><span class="p">,</span> <span class="n">gpts</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">slice_thickness</span><span class="o">=</span><span class="n">slice_thickness</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span>
<span class="p">)</span>

<span class="n">abtem</span><span class="o">.</span><span class="n">show_atoms</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ed2a1da6706709d94eda8a0c9ff26fa45a08dda75de9279e329b44defe7df740.png" src="../../_images/ed2a1da6706709d94eda8a0c9ff26fa45a08dda75de9279e329b44defe7df740.png" />
</div>
</div>
<p>We target the <em>K</em>-edge of oxygen and the <em>L</em><span class="math notranslate nohighlight">\(_{23}\)</span>-edge of strontium. As those would most typically be used in an experiment.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">O_transitions</span> <span class="o">=</span> <span class="n">SubshellTransitions</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="s2">&quot;PBE&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">Sr_transitions</span> <span class="o">=</span> <span class="n">SubshellTransitions</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="mi">38</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="s2">&quot;PBE&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Oxygen K: N_t = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">O_transitions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bound_state</span><span class="p">,</span> <span class="n">continuum_state</span> <span class="ow">in</span> <span class="n">O_transitions</span><span class="o">.</span><span class="n">get_transition_quantum_numbers</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(n, l, ml)  (l&#39;, ml&#39;) = </span><span class="si">{</span><span class="n">bound_state</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">continuum_state</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Strontium L23: N_t = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">Sr_transitions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">bound_state</span><span class="p">,</span> <span class="n">continuum_state</span> <span class="ow">in</span> <span class="n">Sr_transitions</span><span class="o">.</span><span class="n">get_transition_quantum_numbers</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(n, l, ml)  (l&#39;, ml&#39;) = </span><span class="si">{</span><span class="n">bound_state</span><span class="si">}</span><span class="s2">  </span><span class="si">{</span><span class="n">continuum_state</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Oxygen K: N_t = 4
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (0, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (1, -1)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (1, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (1, 0, 0)  (1, 1)
Strontium L23: N_t = 27
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, -1)  (0, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, -1)  (1, -1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, -1)  (1, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, -1)  (1, 1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, -1)  (2, -2)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, -1)  (2, -1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, -1)  (2, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, -1)  (2, 1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, -1)  (2, 2)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 0)  (0, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 0)  (1, -1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 0)  (1, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 0)  (1, 1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 0)  (2, -2)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 0)  (2, -1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 0)  (2, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 0)  (2, 1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 0)  (2, 2)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 1)  (0, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 1)  (1, -1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 1)  (1, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 1)  (1, 1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 1)  (2, -2)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 1)  (2, -1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 1)  (2, 0)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 1)  (2, 1)
(n, l, ml)  (l&#39;, ml&#39;) = (2, 1, 1)  (2, 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">O_transition_potentials</span> <span class="o">=</span> <span class="n">O_transitions</span><span class="o">.</span><span class="n">get_transition_potentials</span><span class="p">(</span><span class="n">energy</span><span class="o">=</span><span class="mf">100e3</span><span class="p">)</span>
<span class="n">O_transition_potentials</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">potential</span><span class="p">)</span>
<span class="n">O_transition_potentials_array</span> <span class="o">=</span> <span class="n">O_transition_potentials</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">Sr_transition_potentials</span> <span class="o">=</span> <span class="n">Sr_transitions</span><span class="o">.</span><span class="n">get_transition_potentials</span><span class="p">(</span><span class="n">energy</span><span class="o">=</span><span class="mf">100e3</span><span class="p">)</span>
<span class="n">Sr_transition_potentials</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">potential</span><span class="p">)</span>
<span class="n">Sr_transition_potentials_array</span> <span class="o">=</span> <span class="n">Sr_transition_potentials</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We see that including all first order transitions will require a significant amount of computations, however, we can eliminate some of the transitions on the basis of the corresponding local transition potential of a specific transition, <span class="math notranslate nohighlight">\(V_{fi, \ local}(\mathbf{k}_{\perp})\)</span>, as a fraction of the local transition potential for all transitions</p>
<div class="math notranslate nohighlight">
\[
\hat{V}_{local}(\mathbf{k}_{\perp}) := \sum_{fi} \hat{V}_{fi, \ local}(\mathbf{k}_{\perp}) = \sum_{fi} |\hat{V}_{fi}(\mathbf{k}_{\perp})|^2 A(\mathbf{k}_{\perp})
\]</div>
<p>We can pick a threshold, <span class="math notranslate nohighlight">\(t\)</span>, and include the smallest set of initial and final states, <span class="math notranslate nohighlight">\(fi'\)</span>, to satisfy</p>
<div class="math notranslate nohighlight">
\[
t &lt; \sum_{fi'} \frac{\int \hat{V}_{fi', \ local}(\mathbf{k}_{\perp}) \mathrm{d}\mathbf{k}_{\perp}}{\int \hat{V}_{local}(\mathbf{k}_{\perp}) \mathrm{d}\mathbf{k}_{\perp}} \quad .
\]</div>
<p>The bar plot below shows the integrated local transition potential (left axis) for each transition ordered according to their integrated intensity. The red line indicates the cumulative sum of integrated local transition potentials. From this figure we can deduce that including the seven most important transitions gives us roughly <span class="math notranslate nohighlight">\(95 \ \%\)</span> of the local potential, which we shall be satisfied with here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intensities</span> <span class="o">=</span> <span class="n">Sr_transition_potentials_array</span><span class="o">.</span><span class="n">integrated_intensities</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">intensities</span><span class="p">)</span>
<span class="n">intensities</span> <span class="o">=</span> <span class="n">intensities</span><span class="p">[</span><span class="n">order</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Sr_transition_potentials_array</span><span class="o">.</span><span class="n">ensemble_axes_metadata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span>
    <span class="n">order</span>
<span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">intensities</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\int V_{fi, \ local} \mathrm</span><span class="si">{d}</span><span class="s2">k \ [eV]$&quot;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">95</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;95 %&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">94</span><span class="p">,</span> <span class="s2">&quot;95 %&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">intensities</span> <span class="o">/</span> <span class="n">intensities</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;r.-&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">105</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative local potential [%]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Cumulative local potential [%]&#39;)
</pre></div>
</div>
<img alt="../../_images/fcb5c55ea6670ec652a1527698fb958638345f3eeb542cd193da196e1055ed5d.png" src="../../_images/fcb5c55ea6670ec652a1527698fb958638345f3eeb542cd193da196e1055ed5d.png" />
</div>
</div>
<p>We can remove the least important transitions using <code class="docutils literal notranslate"><span class="pre">filter_by_intensity</span></code>, reducing the number of transitions from <span class="math notranslate nohighlight">\(27\)</span> to <span class="math notranslate nohighlight">\(9\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filtered_Sr_transition_potentials</span> <span class="o">=</span> <span class="n">Sr_transition_potentials_array</span><span class="o">.</span><span class="n">filter_by_intensity</span><span class="p">(</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">max_angle</span><span class="o">=</span><span class="mi">60</span>
<span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="n">filtered_Sr_transition_potentials</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9
</pre></div>
</div>
</div>
</div>
<p>We create a probe, a scan and a detector as we would for a normal STEM simulation. We use the <code class="docutils literal notranslate"><span class="pre">FlexibleAnnularDetector</span></code> as it is slightly faster than the <code class="docutils literal notranslate"><span class="pre">PixelatedDetector</span></code> (unlike standard multislice the detector has to be applied a significant number of times).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">probe</span> <span class="o">=</span> <span class="n">abtem</span><span class="o">.</span><span class="n">Probe</span><span class="p">(</span>
    <span class="n">semiangle_cutoff</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
    <span class="n">energy</span><span class="o">=</span><span class="mf">100e3</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">probe</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">potential</span><span class="p">)</span>

<span class="n">scan</span> <span class="o">=</span> <span class="n">abtem</span><span class="o">.</span><span class="n">GridScan</span><span class="p">(</span>
    <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">end</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">fractional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">potential</span><span class="o">=</span><span class="n">potential</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">detector</span> <span class="o">=</span> <span class="n">abtem</span><span class="o">.</span><span class="n">FlexibleAnnularDetector</span><span class="p">(</span><span class="n">to_cpu</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Since both the probe and the transition potentials are localized, we can further cut the computational cost by discounting excitations from atoms, where the transition potentials does not overlap significantly with the wave function. We use a rough estimate to determine the contribution to the total intensity of a site <span class="math notranslate nohighlight">\(\mathbf{r}_p\)</span> given a wave function <span class="math notranslate nohighlight">\(\psi(\mathbf{r}_{\perp}, z)\)</span></p>
<div class="math notranslate nohighlight">
\[
    I(\mathbf{r}_p, z) \approx \int V_{local}(\mathbf{r}_{\perp}, \mathbf{r}_{p}) |\psi(\mathbf{r}_{\perp}, z)|^2 \mathrm{d}\mathbf{r}_{\perp}
\]</div>
<p>Given the set of all sites <span class="math notranslate nohighlight">\(\mathbf{r}_p\)</span> within a given thickness, we will include the smallest subset those sites, <span class="math notranslate nohighlight">\(\mathbf{r}_p'\)</span>, to satisfay</p>
<div class="math notranslate nohighlight" id="equation-eq-threshold">
<span class="eqno">(11)<a class="headerlink" href="#equation-eq-threshold" title="Link to this equation">#</a></span>\[
t &lt; \frac{\sum_{\mathbf{r_p}'} I(\mathbf{r}_p', z)}{\sum_{\mathbf{r}_p} I(\mathbf{r}_p, z)} \quad .
\]</div>
<p>Note that the detailed implementation differs slightly from the above description.</p>
<p>Given the probe wave function at position, <span class="math notranslate nohighlight">\(\mathbf{r}_p\)</span>, at the center of the unit cell (the white cross) at <span class="math notranslate nohighlight">\(z=0\)</span>, we show included Oxygen sites below for the three different thresholds. We see that at a threshold of <span class="math notranslate nohighlight">\(99 \ \%\)</span> about half the sites in the cell are included, while at <span class="math notranslate nohighlight">\(95 \ \%\)</span> only the column and it nearest neighbours are included. The condition in Eq. <a class="reference internal" href="#equation-eq-threshold">(11)</a> may be expensive to update at every slice, hence by default it is only updated every 10 slices.</p>
<div class="cell tag_full-width docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sites_all</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[(</span><span class="n">atoms</span><span class="o">.</span><span class="n">numbers</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">atoms</span><span class="o">.</span><span class="n">positions</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)]</span>

<span class="n">position</span> <span class="o">=</span> <span class="n">sites_all</span><span class="p">[</span><span class="mi">38</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">waves</span> <span class="o">=</span> <span class="n">probe</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">position</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ts</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">axes</span><span class="p">):</span>
    <span class="n">absolute_threshold</span> <span class="o">=</span> <span class="n">O_transition_potentials_array</span><span class="o">.</span><span class="n">absolute_threshold</span><span class="p">(</span>
        <span class="n">waves</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">t</span>
    <span class="p">)</span>
    <span class="n">sites</span> <span class="o">=</span> <span class="n">O_transition_potentials_array</span><span class="o">.</span><span class="n">filter_sites</span><span class="p">(</span>
        <span class="n">waves</span><span class="p">,</span> <span class="n">sites_all</span><span class="p">,</span> <span class="n">absolute_threshold</span>
    <span class="p">)</span>
    <span class="n">abtem</span><span class="o">.</span><span class="n">show_atoms</span><span class="p">(</span><span class="n">sites</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sites $t=</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">$&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">position</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/57997299d29a55b5e10b5da9b08856c4c6d08260cd8ad96baa8bb3de365f7b92.png" src="../../_images/57997299d29a55b5e10b5da9b08856c4c6d08260cd8ad96baa8bb3de365f7b92.png" />
</div>
</div>
<p>We run the <code class="docutils literal notranslate"><span class="pre">transition_potential_scan</span></code> with the Oxygen transition potential. We set the threshold for including a site to <span class="math notranslate nohighlight">\(t=0.95\)</span>, we use single-channeling here. We set a lower <code class="docutils literal notranslate"><span class="pre">max_batch</span></code> than normally selected to allow for better parallelization over probe positions. We will also enable task level progress to be displayed, this is only available with the local threads scheduler (the default). The simulation should take slightly more than a minute.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">O_measurements</span> <span class="o">=</span> <span class="n">probe</span><span class="o">.</span><span class="n">transition_potential_scan</span><span class="p">(</span>
    <span class="n">scan</span><span class="o">=</span><span class="n">scan</span><span class="p">,</span>
    <span class="n">potential</span><span class="o">=</span><span class="n">potential</span><span class="p">,</span>
    <span class="n">detectors</span><span class="o">=</span><span class="n">detector</span><span class="p">,</span>
    <span class="n">transition_potentials</span><span class="o">=</span><span class="n">O_transition_potentials_array</span><span class="p">,</span>
    <span class="n">double_channel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">max_batch</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">O_measurements</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">scheduler</span><span class="o">=</span><span class="s2">&quot;threads&quot;</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[########################################] | 100% Completed | 71.59 ss
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;abtem.measurements.PolarMeasurements at 0x7f442be5eed0&gt;
</pre></div>
</div>
</div>
</div>
<p>We run an identical simulation for Strontium, which should be slightly faster than the Oxygen simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Sr_measurements</span> <span class="o">=</span> <span class="n">probe</span><span class="o">.</span><span class="n">transition_potential_scan</span><span class="p">(</span>
    <span class="n">scan</span><span class="o">=</span><span class="n">scan</span><span class="p">,</span>
    <span class="n">potential</span><span class="o">=</span><span class="n">potential</span><span class="p">,</span>
    <span class="n">detectors</span><span class="o">=</span><span class="n">detector</span><span class="p">,</span>
    <span class="n">transition_potentials</span><span class="o">=</span><span class="n">filtered_Sr_transition_potentials</span><span class="p">,</span>
    <span class="n">double_channel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
    <span class="n">max_batch</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">Sr_measurements</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">scheduler</span><span class="o">=</span><span class="s2">&quot;threads&quot;</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[########################################] | 100% Completed | 43.18 ss
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;abtem.measurements.PolarMeasurements at 0x7f442bea5310&gt;
</pre></div>
</div>
</div>
</div>
<p>We stack the measurements and perform the standard post-processing steps for STEM simulations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stacked_measurements</span> <span class="o">=</span> <span class="n">abtem</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">O_measurements</span><span class="p">,</span> <span class="n">Sr_measurements</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;Sr&quot;</span><span class="p">))</span>

<span class="n">post_processed_measurements</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">stacked_measurements</span><span class="o">.</span><span class="n">integrate_radial</span><span class="p">(</span><span class="n">inner</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">outer</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">repetitions</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">sampling</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">visualization</span> <span class="o">=</span> <span class="n">post_processed_measurements</span><span class="o">.</span><span class="n">show</span><span class="p">(</span>
    <span class="n">explode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">common_color_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cbar</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/35222f5e2d243f01a9f7d6af1a01b9963e7dd365dc42dafb14c17d0e5439dcd5.png" src="../../_images/35222f5e2d243f01a9f7d6af1a01b9963e7dd365dc42dafb14c17d0e5439dcd5.png" />
</div>
</div>
<p>The simulations for Oxygen here are made to be similar to those of Fig. 3(c) in <a class="reference external" href="https://doi.org/10.1103/PhysRevB.77.184107">DOI:10.1103/PhysRevB.77.184107</a>, we can interpolate a line profile to get a comparable figure. Our simulation has slightly higher intensity presumably because they use and absorptive potential.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./user_guide\tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="prism.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">PRISM</p>
      </div>
    </a>
    <a class="right-next"
       href="custom_simulation_objects.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Customizing <em>ab</em>TEM</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#core-loss-transitions">Core-loss transitions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transition-potentials">Transition potentials</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#energy-differential-cross-sections">Energy differential cross-sections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#core-loss-filtered">Core-loss filtered</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#core-loss-in-atomic-resolution-imaging">Core-loss in atomic resolution imaging</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By abTEM developers
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>